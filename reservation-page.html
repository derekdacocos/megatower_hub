<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="shortcut icon" type="x-icon" href="src/megatower-hub-iconx.png">
<title>Condo Reservation</title>
<!-- Add Bootstrap 5 CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<!-- Add Bootstrap Datepicker CSS -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">
<!-- Add Swiper CSS -->
<link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css" />
<style>
    /* Custom CSS for swiper */
    .swiper-container {
    height: 50vh; /* Set swiper height to 20% of viewport height */
    }

    .swiper-slide img {
    width: 100%; /* Make images fill the entire width of the swiper */
    height: 100%; /* Make images fill the entire height of the swiper */
    object-fit: cover; /* Maintain aspect ratio and cover entire slide */
    }
</style>
<!-- Start of Async Drift Code -->
<script>
"use strict";

!function() {
  var t = window.driftt = window.drift = window.driftt || [];
  if (!t.init) {
    if (t.invoked) return void (window.console && console.error && console.error("Drift snippet included twice."));
    t.invoked = !0, t.methods = [ "identify", "config", "track", "reset", "debug", "show", "ping", "page", "hide", "off", "on" ], 
    t.factory = function(e) {
      return function() {
        var n = Array.prototype.slice.call(arguments);
        return n.unshift(e), t.push(n), t;
      };
    }, t.methods.forEach(function(e) {
      t[e] = t.factory(e);
    }), t.load = function(t) {
      var e = 3e5, n = Math.ceil(new Date() / e) * e, o = document.createElement("script");
      o.type = "text/javascript", o.async = !0, o.crossorigin = "anonymous", o.src = "https://js.driftt.com/include/" + n + "/" + t + ".js";
      var i = document.getElementsByTagName("script")[0];
      i.parentNode.insertBefore(o, i);
    };
  }
}();
drift.SNIPPET_VERSION = '0.3.1';
drift.load('kin4c3m7twpw');
</script>
<!-- End of Async Drift Code -->
</head>
<body>
<!-- Swiper -->
<div class="swiper-container">
    <div class="swiper-wrapper">
    <!-- Add your swiper slides here -->
    <div class="swiper-slide">
        <img src="src/slide-1.jpg" alt="Slide 1">
    </div>
    <div class="swiper-slide">
        <img src="https://pix8.agoda.net/hotelImages/34725327/0/59a65d8e58beb70a2d438d2603c94a06.jpg?ce=0&s=1024x768g" alt="Slide 2">
    </div>

    <div class="swiper-slide">
        <img src="https://i0.wp.com/rmn.ph/wp-content/uploads/2019/03/pine-trees.jpg?fit=1600%2C1060&ssl=1" alt="Slide 3">
    </div>
    <!-- Add more slides as needed -->
    </div>
</div>
<!-- Check availability form -->
<div class="container availability-form">
    <div class="row">
        <div class="col-lg-12 bg-white shadow p-4 rounded">
            <h5 class="col-lg-3">Condominium Reservation</h5>
            <form id="availabilityForm">
                <div class="row align-items-end">
                    <!-- Type Dropdown -->
                    <div class="col-lg-2 mb-3">
                        <label class="form-label" style="font-weight: 500;">Type</label>
                        <select class="form-select" aria-label="Type" id="typeDropdown">
                            <option selected>Choose...</option>
                            <option value="transient">Transient</option>
                            <option value="buy">Buy</option>
                            <option value="lease">Lease</option>
                        </select>
                    </div>
                    <div class="col-lg-2 mb-3">
                        <label class="form-label" style="font-weight: 500;">Check-in</label>
                        <input type="date" class="form-control shadow-none datepicker" id="checkInDate">
                    </div>
                    <div class="col-lg-2 mb-3">
                        <label class="form-label" style="font-weight: 500;">Check-out</label>
                        <input type="date" class="form-control shadow-none datepicker" id="checkOutDate">
                    </div>                    
                    <div class="col-lg-1 mb-3">
                        <label class="form-label" style="font-weight: 500;">Guests</label>
                        <div class="input-group">
                            <button type="button" class="btn btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#guestModal">
                                Guests
                            </button>
                        </div>
                    </div>
                    <!-- Add amenities button -->
                    <div class="col-lg-3 mb-3">
                        <label class="form-label" style="font-weight: 500;">Amenities</label>
                        <div class="input-group">
                            <button type="button" class="btn btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#amenitiesModal">
                                Amenities
                            </button>
                        </div>
                    </div>
                    <div class="col-lg-1 mb-3">
                        <button type="submit" class="btn text-white shadow-none bg-primary">Submit</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>


<!-- Guest Modal -->
<div class="modal fade" id="guestModal" tabindex="-1" aria-labelledby="guestModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="guestModalLabel">Select Guests</h5>
                <!-- Replace the close button with a cancel button -->
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="adultsCount">Adults</label>
                    <input type="number" class="form-control" id="adultsCount" min="1" value="1">
                </div>
                <div class="mb-3">
                    <label for="childrenCount">Children</label>
                    <input type="number" class="form-control" id="childrenCount" min="0" value="0">
                </div>
            </div>
            <div class="modal-footer">
                <!-- Update the "Apply Changes" button to close the modal -->
                <button type="button" class="btn btn-primary" onclick="updateGuestCount()" data-bs-dismiss="modal">Apply Changes</button>
            </div>
        </div>
    </div>
</div>
<!-- Amenities Modal -->
<div class="modal fade" id="amenitiesModal" tabindex="-1" aria-labelledby="amenitiesModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="amenitiesModalLabel">Select Amenities</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <h6>Kitchen</h6>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="Dishes and dining utensils" id="amenityDishes">
                    <label class="form-check-label" for="amenityDishes">Dishes and dining utensils</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="Microwave" id="amenityMicrowave">
                    <label class="form-check-label" for="amenityMicrowave">Microwave</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="Refrigerator" id="amenityRefrigerator">
                    <label class="form-check-label" for="amenityRefrigerator">Refrigerator</label>
                </div>

                <h6>Bathroom</h6>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="Body wash" id="amenityBodyWash">
                    <label class="form-check-label" for="amenityBodyWash">Body wash</label>
                </div>

                <h6>Bedroom</h6>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="Fans (ceiling or portable)" id="amenityFans">
                    <label class="form-check-label" for="amenityFans">Fans (ceiling or portable)</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="Linens" id="amenityLinens">
                    <label class="form-check-label" for="amenityLinens">Linens</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="Hair dryer" id="amenityHairDryer">
                    <label class="form-check-label" for="amenityHairDryer">Hair dryer</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="Toiletries" id="amenityToiletries">
                    <label class="form-check-label" for="amenityToiletries">Toiletries</label>
                </div>

                <h6>General</h6>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="Laundromat nearby" id="amenityLaundromat">
                    <label class="form-check-label" for="amenityLaundromat">Laundromat nearby</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="Internet" id="amenityInternet">
                    <label class="form-check-label" for="amenityInternet">Internet</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="TV" id="amenityTV">
                    <label class="form-check-label" for="amenityTV">TV</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="Wi-Fi" id="amenityWiFi">
                    <label class="form-check-label" for="amenityWiFi">Wi-Fi</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="Coffee or tea" id="amenityCoffeeTea">
                    <label class="form-check-label" for="amenityCoffeeTea">Coffee or tea</label>
                </div>

                <h6>Security</h6>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="Doorman" id="amenityDoorman">
                    <label class="form-check-label" for="amenityDoorman">Doorman</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="Fire extinguisher" id="amenityFireExtinguisher">
                    <label class="form-check-label" for="amenityFireExtinguisher">Fire extinguisher</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="Smoke detector" id="amenitySmokeDetector">
                    <label class="form-check-label" for="amenitySmokeDetector">Smoke detector</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="Security [24-hour]" id="amenitySecurity24">
                    <label class="form-check-label" for="amenitySecurity24">Security [24-hour]</label>
                </div>
            </div>
            <div class="modal-footer">
                
            </div>
        </div>
    </div>
</div>

<!-- Add the label for available rooms -->
<div class="container mt-4" id="availableRoomsLabel" style="display: none;">
    <h2 class="text-center">Available Rooms</h2>
</div>

<!-- Available Rooms -->
<div class="container">
    <div class="row" id="availableRooms">
        <!-- Room cards will be dynamically added here -->
    </div>
</div>

<!-- Amenities section -->
<div class="container amenities-section mt-4">
    <div class="row">
        <div class="col-lg-12 bg-white shadow p-4 rounded">
            <h2 class="col-lg-12 text-center mb-4">Amenities and Facilities</h2>
            <div class="row">
                <!-- Column 1 -->
                <div class="col-md-6 col-lg-3 mb-3">
                    <ul>
                        <li><strong>Kitchen</strong></li>
                            <ul>
                                <li>Dishes and dining utensils</li>
                                <li>Microwave</li>
                                <li>Refrigerator</li>
                            </ul>
                        <li><strong>Bathroom</strong></li>
                            <ul>
                                <li>Body wash</li>
                            </ul>
                        <li><strong>Standard</strong></li>
                            <ul>
                                <li>Fans (ceiling or portable)</li>
                                <li>Laundromat nearby</li>
                            </ul>
                    </ul>
                </div>
                <!-- Column 2 -->
                <div class="col-md-6 col-lg-3 mb-3">
                    <ul>
                        <li><strong>Outdoor</strong></li>
                            <ul>
                                <li>Garden or backyard</li>
                            </ul>
                        <li><strong>Entertainment</strong></li>
                            <ul>
                                <li>Internet</li>
                                <li>TV</li>
                                <li>Wi-Fi</li>
                            </ul>
                        <li><strong>Comforts</strong></li>
                            <ul>
                                <li>Linens</li>
                            </ul>
                    </ul>
                </div>
                <!-- Column 3 -->
                <div class="col-md-6 col-lg-3 mb-3">
                    <ul>
                        <li><strong>Dining, drinking, and snacking</strong></li>
                            <ul>
                                <li>Coffee or tea</li>
                            </ul>
                        <li><strong>Bathroom and toiletries</strong></li>
                            <ul>
                                <li>Hair dryer</li>
                                <li>Toiletries</li>
                            </ul>
                        <li><strong>Services and conveniences</strong></li>
                            <ul>
                                <li>Doorman</li>
                                <li>Elevator</li>
                            </ul>
                    </ul>
                </div>
                <!-- Column 4 -->
                <div class="col-md-6 col-lg-3 mb-3">
                    <ul>
                        <li><strong>Safety and security features</strong></li>
                            <ul>
                                <li>Fire extinguisher</li>
                                <li>Smoke detector</li>
                            </ul>
                        <li><strong>Access</strong></li>
                            <ul>
                                <li>Security [24-hour]</li>
                            </ul>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Booking Modal -->
<div class="modal fade" id="bookingModal" tabindex="-1" aria-labelledby="bookingModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="bookingModalLabel">Complete Your Booking</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="bookingForm">
                    <div class="mb-3">
                        <label for="fullName" class="form-label">Full Name</label>
                        <input type="text" class="form-control" id="fullName" required>
                    </div>
                    <div class="mb-3">
                        <label for="email" class="form-label">Email</label>
                        <input type="email" class="form-control" id="email" required>
                    </div>
                    <input type="hidden" id="roomId">
                    <input type="hidden" id="bookingCheckInDate">
                    <input type="hidden" id="bookingCheckOutDate">
                </form>
                <p>Check our payment channel for booking. <a href="landing-payment.html" target="_blank">Payment Channels</a></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="submit" class="btn btn-primary" form="bookingForm">Submit Booking</button>
            </div>
        </div>
    </div>
</div>

<!-- Add Bootstrap 5 JS and Popper.js -->
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<!-- Add jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- Add Bootstrap Datepicker JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>
<!-- Add Swiper JS -->
<script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-database.js"></script>
<script>
// Firebase configuration
const firebaseConfig = {
    apiKey: "AIzaSyB0w3oovf85ZTyZBfKapuZxx1i0OiGyRZ0",
    authDomain: "megatower-hub-ca285.firebaseapp.com",
    databaseURL: "https://megatower-hub-ca285-default-rtdb.firebaseio.com",
    projectId: "megatower-hub-ca285",
    storageBucket: "megatower-hub-ca285.appspot.com",
    messagingSenderId: "900973693171",
    appId: "1:900973693171:web:9062bf9b49221596294f86"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);

// Get a reference to the database service
const database = firebase.database();

// Function to update the guest count
function updateGuestCount() {
    var adultsCount = document.getElementById('adultsCount').value;
    var childrenCount = document.getElementById('childrenCount').value;

    // Set the placeholder of the "Guests" button
    document.querySelector('.input-group button').textContent = (parseInt(adultsCount) + parseInt(childrenCount));

    // You can also perform any other action you need here
}

// Function to format price into a more readable format
function formatPrice(price) {
    // Convert price to string and add commas
    var formattedPrice = price.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    
    // Return formatted price with currency symbol
    return 'â‚±' + formattedPrice;
}

document.getElementById('availabilityForm').addEventListener('submit', function(event) {
    event.preventDefault(); // Prevent the form from submitting in the traditional way

    var checkInDate = new Date(document.getElementById('checkInDate').value);
    var checkOutDate = new Date(document.getElementById('checkOutDate').value);
    var selectedAmenities = Array.from(document.querySelectorAll('#amenitiesModal input[type="checkbox"]:checked')).map(function(checkbox) {
        return checkbox.value;
    });
    var selectedType = document.getElementById('typeDropdown').value; // Get the selected type
    var adultsCount = document.getElementById('adultsCount').value;
    var childrenCount = document.getElementById('childrenCount').value;
    
    // Calculate the total number of guests
    var guestsCount = parseInt(adultsCount) + parseInt(childrenCount);

    database.ref('rooms').once('value', function(snapshot) {
        var rooms = snapshot.val();
        var availableRoomHtml = '';

        Object.keys(rooms).forEach(function(roomId) {
            var room = rooms[roomId];
            if (room.availability === 'available' && selectedAmenities.every(amenity => room.amenities.includes(amenity))) {
                // Check if the room type matches the selected type
                if (selectedType === 'Choose...' || room.type === selectedType) {
                    // Assuming the room is available if there are no bookedDates overlapping the requested period
                    var isOverlapping = Object.keys(room.bookedDates || {}).some(function(date) {
                        var bookedDate = new Date(date);
                        return bookedDate >= checkInDate && bookedDate <= checkOutDate;
                    });

                    if (!isOverlapping && (parseInt(adultsCount) + parseInt(childrenCount)) <= room.capacity) {
                        // Inside the JavaScript where you generate the room cards
                        availableRoomHtml += `
                            <div class="col-lg-4 col-md-6 my-3">
                                <div class="card h-100 border-0 shadow">
                                    <img src="${room.image}" class="card-img-top" alt="Room Image">
                                    <div class="card-body d-flex flex-column justify-content-between">
                                        <div>
                                            <h5 class="card-title">${room.category}</h5>
                                            <h6 class="mb-4">Room: ${room.room}</h6>
                                            <h6 class="mb-4">Price: ${formatPrice(room.price)}</h6> <!-- Format the price here -->
                                            <div class="amenities mb-4">
                                                <h6 class="mb-1">Amenities</h6>
                                                ${room.amenities && room.amenities.length > 0 ? room.amenities.map(amenity => `<span class="badge rounded-pill bg-light text-dark text-wrap">${amenity}</span>`).join('') : ''}
                                            </div>
                                            <div class="capacity mb-4">
                                                <h6 class="mb-1">Capacity</h6>
                                                <span class="badge rounded-pill bg-light text-dark text-wrap">${room.capacity}</span>
                                            </div>
                                        </div>
                                        <button class="btn btn-sm btn-primary text-white shadow-none mt-auto" onclick="openBookingModal('${roomId}')">Book Now</button>
                                    </div>
                                </div>
                            </div>
                        `;
                    }
                }
            }
        });

        if (availableRoomHtml === '') {
            availableRoomHtml = '<div class="col-lg-12"><p class="text-center">No rooms available for the selected criteria.</p></div>';
        }

        document.getElementById('availableRooms').innerHTML = availableRoomHtml;

        // Show the "Available Rooms" label after submitting the form
        document.getElementById('availableRoomsLabel').style.display = 'block';
    });
});

function openBookingModal(roomId) {
    // Set the room ID in the hidden input of the booking form
    document.getElementById('roomId').value = roomId;

    // Now open the modal (Bootstrap 5)
    var bookingModal = new bootstrap.Modal(document.getElementById('bookingModal'));
    bookingModal.show();
}

function openBookingModal(roomId) {
    // Set the room ID in the hidden input of the booking form
    document.getElementById('roomId').value = roomId;

    // Now open the modal (Bootstrap 5)
    var bookingModal = new bootstrap.Modal(document.getElementById('bookingModal'));
    bookingModal.show();
}

document.getElementById('bookingForm').addEventListener('submit', function(event) {
    event.preventDefault();

    // Gather booking information
    var fullName = document.getElementById('fullName').value;
    var email = document.getElementById('email').value;
    var roomId = document.getElementById('roomId').value; // Captured room UID
    var checkInDate = document.getElementById('checkInDate').value;
    var checkOutDate = document.getElementById('checkOutDate').value;

    // Submit booking to Firebase under a specific room UID
    var newReservationRef = firebase.database().ref('reservations').push();
    newReservationRef.set({
        roomId: roomId,
        fullName: fullName,
        email: email,
        checkInDate: checkInDate,
        checkOutDate: checkOutDate,
        status: 'pending'
    }).then(() => {
        alert('Your booking is submitted and pending confirmation.');
        $('#bookingModal').modal('hide');
    }).catch((error) => {
        console.error('Error submitting booking:', error);
    });
});


// Initialize Swiper
var swiper = new Swiper('.swiper-container', {
    // Add your swiper options here
    loop: true, // Loop through slides
    autoplay: {
    delay: 3000, // Time between slides (in milliseconds)
    },
});
</script>
<script>
// Initialize Datepicker
$(document).ready(function(){
    var today = new Date();
    today.setHours(0, 0, 0, 0);  // Set hours to 0 to include the entire day

    $('#checkInDate').datepicker({
    autoclose: true,
    format: 'yyyy-mm-dd',
    startDate: today,
    todayHighlight: true
    });

    $('#checkOutDate').datepicker({
    autoclose: true,
    format: 'yyyy-mm-dd',
    startDate: today,
    todayHighlight: true
    });

    // Optionally, you can set the start date of the second datepicker to the selected date in the first datepicker.
    $('#checkInDate').on('changeDate', function(selected){
    var startDate = new Date(selected.date.valueOf());
    $('#checkOutDate').datepicker('setStartDate', startDate);
    });
});
</script>
</body>
</html>