<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Room Category</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <style>
        .category-form {
            max-width: 400px;
        }
        .room-table {
            border: 1px solid #dee2e6;
        }
        .room-table th, .room-table td {
            border: 1px solid #dee2e6;
            padding: 8px;
        }
    </style>
</head>
<body>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg bg-dark navbar-dark fixed-top">
        <div class="container">
            <a href="admin-dashboard.html" class="navbar-brand">Megatower Hub
                <span class="text-secondary" style="font-size: 0.8em;">Admin Dashboard</span>
            </a>

            <button class="navbar-toggler" 
            type="button" 
            data-bs-toggle="collapse" 
            data-bs-target="#navmenu" 
            aria-controls="navmenu" 
            aria-expanded="false" 
            aria-label="Toggle navigation menu">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navmenu">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a href="#" class="nav-link text-light">Notifications</a>
                    </li>
                    <li class="nav-item">
                        <a href="admin-complaints.html" class="nav-link text-light">Complaints</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle text-light" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Request
                        </a>
                        <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                            <a class="dropdown-item" href="admin-maintenance.html">Maintenance</a>
                            <a class="dropdown-item" href="admin-cleaning.html">Cleaning</a>
                        </div>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle text-light" href="#" id="roomsDropdown" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Rooms
                        </a>
                        <div class="dropdown-menu" aria-labelledby="roomsDropdown">
                            <a class="dropdown-item" href="admin-room-category.html">Room Category</a>
                            <a class="dropdown-item" href="admin-room-form.html">Room Form</a>
                        </div>
                    </li>
                    <li class="nav-item">
                    <a href="user-management.html" class="nav-link text-light">Users</a>
                </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link text-light">Profile</a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link text-light" id="logoutBtn">Logout</a>
                    </li>
                </ul>
            </div>
        </div>   
    </nav>

    <div class="container mt-5">
        <div class="row">
            <div class="col-md-6">
                <h2>Add Room Category</h2>
                <form id="roomCategoryForm" class="category-form">
                    <div class="mb-3">
                        <label for="category" class="form-label">Category</label>
                        <input type="text" class="form-control" id="category" required>
                    </div>
                    <div class="mb-3">
                        <label for="type" class="form-label">Type</label>
                        <select class="form-select" id="type" required>
                            <option value="transient">Transient</option>
                            <option value="lease">Lease</option>
                            <option value="buy">Buy</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="maxGuests" class="form-label">Max Guests</label>
                        <input type="number" class="form-control" id="maxGuests" required>
                    </div>
                    <div class="mb-3">
                        <label for="price" class="form-label">Price</label>
                        <input type="number" class="form-control" id="price" required>
                    </div>
                    <div class="mb-3">
                        <label for="image" class="form-label">Image</label>
                        <input type="file" class="form-control" id="image" accept="image/*" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Add Room Category</button>
                </form>
            </div>
            <div class="col-md-6">
                <h2>Room Categories</h2>
                <table class="table room-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Image</th>
                            <th>Rooms</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="roomCategoryTableBody">
                        <!-- Room categories will be dynamically populated here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Edit Room Category Modal -->
    <div class="modal fade" id="editRoomCategoryModal" tabindex="-1" aria-labelledby="editRoomCategoryModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editRoomCategoryModalLabel">Edit Room Category</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editRoomCategoryForm">
                        <div class="mb-3">
                            <label for="editCategory" class="form-label">Category</label>
                            <input type="text" class="form-control" id="editCategory" required>
                        </div>
                        <div class="mb-3">
                            <label for="editPrice" class="form-label">Price</label>
                            <input type="number" class="form-control" id="editPrice" required>
                        </div>
                        <div class="mb-3">
                            <label for="editType" class="form-label">Type</label>
                            <select class="form-select" id="editType" required>
                                <option value="transient">Transient</option>
                                <option value="lease">Lease</option>
                                <option value="buy">Buy</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="editMaxGuests" class="form-label">Max Guests</label>
                            <input type="number" class="form-control" id="editMaxGuests" required>
                        </div>
                        <input type="hidden" id="editRoomCategoryId">
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveEditedRoomCategory()">Save Changes</button>
                </div>
            </div>
        </div>
    </div>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-storage.js"></script>
<script>
    // Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyB0w3oovf85ZTyZBfKapuZxx1i0OiGyRZ0",
        authDomain: "megatower-hub-ca285.firebaseapp.com",
        databaseURL: "https://megatower-hub-ca285-default-rtdb.firebaseio.com",
        projectId: "megatower-hub-ca285",
        storageBucket: "megatower-hub-ca285.appspot.com",
        messagingSenderId: "900973693171",
        appId: "1:900973693171:web:9062bf9b49221596294f86"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);

    // References to Firebase services
    const database = firebase.database();
    const storage = firebase.storage();

    // Room category form and table body
    const roomCategoryForm = document.getElementById('roomCategoryForm');
    const roomCategoryTableBody = document.getElementById('roomCategoryTableBody');

    // Function to add a room category
    roomCategoryForm.addEventListener('submit', function(event) {
        event.preventDefault();
        
        // Get form values
        const category = document.getElementById('category').value;
        const price = document.getElementById('price').value;
        const type = document.getElementById('type').value;
        const maxGuests = document.getElementById('maxGuests').value;
        const image = document.getElementById('image').files[0];
        const name = category + ' (' + type + ')';

        // Upload image to Firebase Storage
        const storageRef = storage.ref('room_images/' + image.name);
        storageRef.put(image)
            .then(snapshot => snapshot.ref.getDownloadURL())
            .then(downloadURL => {
                // Add room category data to Firebase Realtime Database
                const roomCategoryData = {
                    category: category,
                    price: price,
                    type: type,
                    maxGuests: maxGuests,
                    name: name,
                    image: downloadURL
                };
                database.ref('room_categories').push(roomCategoryData);
            })
            .catch(error => {
                console.error('Error uploading image: ', error);
            });

        roomCategoryForm.reset();
    });

    // Display room categories in the table
    database.ref('room_categories').on('value', function(snapshot) {
        roomCategoryTableBody.innerHTML = '';
        let count = 1;

        snapshot.forEach(function(childSnapshot) {
            const data = childSnapshot.val();
            const key = childSnapshot.key;
            const imageUrl = data.image;
            const name = data.category + ' (' + data.type + ')';
            const maxGuests = data.maxGuests;

            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${count++}</td>
                <td><img src="${imageUrl}" alt="Room Image" style="max-width: 100px;"></td>
                <td>Name: <strong>${name}</strong><br>Price: â‚±<strong>${data.price}</strong><br>Max Guests: <strong>${maxGuests}</strong></td>
                <td>
                    <button type="button" class="btn btn-primary btn-sm" onclick="editRoomCategory('${key}', '${data.category}', '${data.price}', '${data.type}', '${maxGuests}')">Edit</button>
                    <button type="button" class="btn btn-danger btn-sm" onclick="deleteRoomCategory('${key}')">Delete</button>
                </td>
            `;
            roomCategoryTableBody.appendChild(tr);
        });
    });

    // Function to edit room category
    function editRoomCategory(id, category, price, type, maxGuests) {
        document.getElementById('editCategory').value = category;
        document.getElementById('editPrice').value = price;
        document.getElementById('editType').value = type;
        document.getElementById('editMaxGuests').value = maxGuests;
        document.getElementById('editRoomCategoryId').value = id;
        // Open the Bootstrap modal using jQuery
        $('#editRoomCategoryModal').modal('show');
    }

    // Function to save edited room category
    function saveEditedRoomCategory() {
        const id = document.getElementById('editRoomCategoryId').value;
        const category = document.getElementById('editCategory').value;
        const price = document.getElementById('editPrice').value;
        const type = document.getElementById('editType').value;
        const maxGuests = document.getElementById('editMaxGuests').value;

        database.ref('room_categories').child(id).update({
            category: category,
            price: price,
            type: type,
            maxGuests: maxGuests
        }).then(() => {
            $('#editRoomCategoryModal').modal('hide');
        }).catch(error => {
            console.error('Error updating room category: ', error);
        });
    }

    // Function to delete room category
    function deleteRoomCategory(key) {
        if (confirm('Are you sure you want to delete this room category?')) {
            database.ref('room_categories').child(key).remove()
                .then(() => {
                    console.log('Room category deleted successfully');
                })
                .catch(error => {
                    console.error('Error deleting room category: ', error);
                });
        }
    }
</script>

</body>
</html>
